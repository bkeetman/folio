<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Folio Downloads</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <main class="page">
      <header class="hero">
        <div class="hero-logo">
          <img src="folio-icon.png" alt="Folio" />
        </div>
        <div>
          <p class="eyebrow">Folio Desktop</p>
          <h1>Download Folio</h1>
          <p class="version" id="release-version">Latest release</p>
          <p class="lede">
            A calm, local library for people with folders full of ebooks who want a clean, organized shelf.
          </p>
        </div>
      </header>

      <section class="overview">
        <div class="overview-card">
          <h3>What it does</h3>
          <p>
            Scans your library, matches metadata, and lets you approve clean file changes.
          </p>
        </div>
        <div class="overview-card">
          <h3>How it works</h3>
          <p>
            Choose a folder, review suggested fixes, then apply only what you want.
          </p>
        </div>
        <div class="overview-card">
          <h3>Ideal for</h3>
          <p>
            Calm, local collectors who want stable filenames and a tidy shelf.
          </p>
        </div>
      </section>

      <section class="downloads" id="downloads">
        <a class="card" data-platform="darwin-aarch64" href="https://github.com/bkeetman/folio/releases/latest" target="_blank" rel="noreferrer">
          <div class="card-header">
            <div class="platform-icon" aria-hidden="true">
              <svg viewBox="0 0 24 24" role="img">
                <path d="M16.4 13.2c0 2.7 2.3 3.6 2.3 3.7-.6 1.7-2.4 4-4.3 4-1.7 0-2.2-1.1-4.1-1.1-1.9 0-2.5 1.1-4.2 1.1-1.8 0-3.1-2.1-3.7-3.8-1-2.7-1.1-5.9.7-7.7 1.2-1.2 2.9-1.5 4.1-.7.8.5 1.5.8 2.4.8.9 0 1.5-.3 2.4-.8 1.2-.8 2.7-.6 3.6.4-1.2.7-2.1 2-2.1 3.4zm-2.5-8.3c0 1-.4 2-1.1 2.7-.7.7-1.7 1.1-2.6 1-.1-.9.3-2 1-2.7.7-.7 1.8-1.2 2.7-1z" />
              </svg>
            </div>
            <div>
              <h2>macOS</h2>
              <p class="card-subtitle">Signed DMG installers for Apple Silicon or Intel.</p>
            </div>
          </div>
          <div class="card-meta">
            <p class="card-file" data-file>DMG</p>
            <p class="card-version" data-version>Latest</p>
          </div>
          <div class="card-links" data-links></div>
        </a>
        <a class="card" data-platform="windows-x86_64" href="https://github.com/bkeetman/folio/releases/latest" target="_blank" rel="noreferrer">
          <div class="card-header">
            <div class="platform-icon" aria-hidden="true">
              <svg viewBox="0 0 24 24" role="img">
                <rect x="2" y="3" width="9" height="8" rx="1" />
                <rect x="13" y="3" width="9" height="8" rx="1" />
                <rect x="2" y="13" width="9" height="8" rx="1" />
                <rect x="13" y="13" width="9" height="8" rx="1" />
              </svg>
            </div>
            <div>
              <h2>Windows</h2>
              <p class="card-subtitle">MSI installer with EXE fallback for Windows 10/11.</p>
            </div>
          </div>
          <div class="card-meta">
            <p class="card-file" data-file>MSI</p>
            <p class="card-version" data-version>Latest</p>
          </div>
          <div class="card-links" data-links></div>
        </a>
        <a class="card" data-platform="linux-x86_64" href="https://github.com/bkeetman/folio/releases/latest" target="_blank" rel="noreferrer">
          <div class="card-header">
            <div class="platform-icon" aria-hidden="true">
              <svg viewBox="0 0 24 24" role="img">
                <circle cx="12" cy="9" r="4" />
                <path d="M6 21c0-4 3-6 6-6s6 2 6 6" />
                <circle cx="10.5" cy="8.5" r="0.8" fill="#fff" />
                <circle cx="13.5" cy="8.5" r="0.8" fill="#fff" />
              </svg>
            </div>
            <div>
              <h2>Linux</h2>
              <p class="card-subtitle">AppImage with DEB or RPM options for package installs.</p>
            </div>
          </div>
          <div class="card-meta">
            <p class="card-file" data-file>AppImage</p>
            <p class="card-version" data-version>Latest</p>
          </div>
          <div class="card-links" data-links></div>
        </a>
      </section>

      <section class="notes">
        <h3>Notes</h3>
        <ul>
          <li>Downloads are served from GitHub Releases.</li>
          <li>macOS builds should be signed and notarized for best UX.</li>
        </ul>
      </section>
    </main>
      <script>
        const versionEl = document.getElementById("release-version");
        const cards = Array.from(document.querySelectorAll("[data-platform]"));

        fetch("latest.json", { cache: "no-store" })
          .then((res) => (res.ok ? res.json() : null))
          .then((data) => {
            if (!data) return;
            if (versionEl) {
              versionEl.textContent = `Latest release: v${data.version}`;
            }
            const downloads = data.downloads || {};
            const platformLinks = {
              "darwin-aarch64": {
                primary: downloads.macos?.arm64 || downloads.macos?.x64 || downloads.macos?.dmg,
                files: [
                  { label: "DMG (Apple Silicon)", url: downloads.macos?.arm64 || downloads.macos?.dmg },
                  { label: "DMG (Intel)", url: downloads.macos?.x64 },
                ],
              },
              "windows-x86_64": {
                primary: downloads.windows?.msi || downloads.windows?.exe,
                files: [
                  { label: "MSI", url: downloads.windows?.msi },
                  { label: "EXE", url: downloads.windows?.exe },
                ],
              },
              "linux-x86_64": {
                primary: downloads.linux?.appimage || downloads.linux?.deb || downloads.linux?.rpm,
                files: [
                  { label: "AppImage", url: downloads.linux?.appimage },
                  { label: "DEB", url: downloads.linux?.deb },
                  { label: "RPM", url: downloads.linux?.rpm },
                ],
              },
            };
            cards.forEach((card) => {
              const platform = card.getAttribute("data-platform");
              const platformInfo = data.platforms?.[platform];
              const download = platformLinks[platform];
              const primaryUrl = download?.primary || platformInfo?.url;
              if (primaryUrl) {
                card.setAttribute("href", primaryUrl);
              }
              const versionLabel = card.querySelector("[data-version]");
              if (versionLabel) {
                versionLabel.textContent = `v${data.version}`;
              }
              const fileLabel = card.querySelector("[data-file]");
              if (fileLabel && download?.primary) {
                const fileType = download.files.find((file) => file.url === download.primary)?.label;
                if (fileType) {
                  fileLabel.textContent = fileType;
                }
              }
              const linksEl = card.querySelector("[data-links]");
              if (linksEl && download?.files) {
                linksEl.innerHTML = "";
                download.files
                  .filter((file) => file.url)
                  .forEach((file) => {
                    const link = document.createElement("a");
                    link.className = "card-link";
                    link.href = file.url;
                    link.target = "_blank";
                    link.rel = "noreferrer";
                    link.textContent = file.label;
                    linksEl.appendChild(link);
                  });
              }
            });
          })
          .catch(() => {});
      </script>
  </body>
</html>
