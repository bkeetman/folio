<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Folio Downloads</title>
    <link rel="stylesheet" href="style.css?v=1.0.1" />
  </head>
  <body>
    <main class="page">
      <header class="hero">
        <div class="hero-logo">
          <img src="folio-icon.png" alt="Folio" />
        </div>
        <div>
          <p class="eyebrow">Folio Desktop</p>
          <h1>Download Folio</h1>
          <p class="version" id="release-version">Latest release</p>
          <p class="lede">
            A calm, modern eBook manager for your personal collection. Focus on metadata, clean file names, and local sovereignty.
          </p>
        </div>
      </header>

      <section class="features" aria-label="Key features">
        <div class="feature-card">
          <div class="feature-icon">üìö</div>
          <h3>Calm Library</h3>
          <p>
            Organize your massive eBook collection without the cloud clutter or lock-in.
          </p>
        </div>
        <div class="feature-card">
          <div class="feature-icon">‚ú®</div>
          <h3>Smart Metadata</h3>
          <p>
            Scan your folders and automatically repair titles, authors, and covers with ease.
          </p>
        </div>
        <div class="feature-card">
          <div class="feature-icon">üõ°Ô∏è</div>
          <h3>Local First</h3>
          <p>
            Your data stays on your machine. No tracking, no accounts, just your books.
          </p>
        </div>
      </section>

      <section class="app-preview" aria-label="App Preview">
        <div class="screenshot-container">
          <img src="app-screenshot.png" alt="Folio in action" class="app-screenshot" />
        </div>
      </section>

      <section class="platform-selector">
        <h2>Choose your installer</h2>
        <div class="downloads" id="downloads">
          <article class="card" data-platform="darwin-aarch64">
            <div class="card-header">
              <div class="platform-icon" aria-hidden="true">
                <svg viewBox="0 0 24 24" role="img">
                  <path d="M16.4 13.2c0 2.7 2.3 3.6 2.3 3.7-.6 1.7-2.4 4-4.3 4-1.7 0-2.2-1.1-4.1-1.1-1.9 0-2.5 1.1-4.2 1.1-1.8 0-3.1-2.1-3.7-3.8-1-2.7-1.1-5.9.7-7.7 1.2-1.2 2.9-1.5 4.1-.7.8.5 1.5.8 2.4.8.9 0 1.5-.3 2.4-.8 1.2-.8 2.7-.6 3.6.4-1.2.7-2.1 2-2.1 3.4zm-2.5-8.3c0 1-.4 2-1.1 2.7-.7.7-1.7 1.1-2.6 1-.1-.9.3-2 1-2.7.7-.7 1.8-1.2 2.7-1z" />
                </svg>
              </div>
              <div>
                <h2>macOS</h2>
                <p class="card-subtitle">DMG for Apple Silicon and Intel Macs.</p>
              </div>
            </div>
            <div class="card-meta">
              <span class="badge" data-file>DMG</span>
              <span class="badge secondary" data-version>Latest</span>
            </div>
            <a class="primary-download" data-primary-link href="https://github.com/bkeetman/folio/releases/latest" target="_blank" rel="noreferrer">Download Recommended</a>
            <div class="card-links" data-links></div>
          </article>

          <article class="card" data-platform="windows-x86_64">
            <div class="card-header">
              <div class="platform-icon" aria-hidden="true">
                <svg viewBox="0 0 24 24" role="img">
                  <rect x="2" y="3" width="9" height="8" rx="1" />
                  <rect x="13" y="3" width="9" height="8" rx="1" />
                  <rect x="2" y="13" width="9" height="8" rx="1" />
                  <rect x="13" y="13" width="9" height="8" rx="1" />
                </svg>
              </div>
              <div>
                <h2>Windows</h2>
                <p class="card-subtitle">Windows 10/11 MSI or EXE installers.</p>
              </div>
            </div>
            <div class="card-meta">
              <span class="badge" data-file>MSI</span>
              <span class="badge secondary" data-version>Latest</span>
            </div>
            <a class="primary-download" data-primary-link href="https://github.com/bkeetman/folio/releases/latest" target="_blank" rel="noreferrer">Download Recommended</a>
            <div class="card-links" data-links></div>
          </article>

          <article class="card" data-platform="linux-x86_64">
            <div class="card-header">
              <div class="platform-icon" aria-hidden="true">
                <svg viewBox="0 0 24 24" role="img">
                  <circle cx="12" cy="9" r="4" />
                  <path d="M6 21c0-4 3-6 6-6s6 2 6 6" />
                  <circle cx="10.5" cy="8.5" r="0.8" fill="#fff" />
                  <circle cx="13.5" cy="8.5" r="0.8" fill="#fff" />
                </svg>
              </div>
              <div>
                <h2>Linux</h2>
                <p class="card-subtitle">AppImage, DEB and RPM for most distros.</p>
              </div>
            </div>
            <div class="card-meta">
              <span class="badge" data-file>AppImage</span>
              <span class="badge secondary" data-version>Latest</span>
            </div>
            <a class="primary-download" data-primary-link href="https://github.com/bkeetman/folio/releases/latest" target="_blank" rel="noreferrer">Download Recommended</a>
            <div class="card-links" data-links></div>
          </article>
        </div>
      </section>

      <section class="instructions">
        <div class="instruction-card mac-notice">
          <h3>Installing on macOS</h3>
          <p>
            Since Folio is not signed with a paid developer certificate, you need to clear the quarantine attribute after moving the app to your Applications folder:
          </p>
          <div class="terminal">
            <code>xattr -cr /Applications/Folio.app</code>
            <button class="copy-btn" onclick="copyCommand(this)">Copy</button>
          </div>
        </div>
      </section>

      <footer class="footer">
        <div class="footer-section">
          <h3>Resources</h3>
          <ul class="release-links">
            <li><a id="release-page-link" href="https://github.com/bkeetman/folio/releases/latest" target="_blank" rel="noreferrer">Latest Release Notes</a></li>
            <li><a href="https://github.com/bkeetman/folio/releases" target="_blank" rel="noreferrer">All Releases</a></li>
            <li><a href="https://github.com/bkeetman/folio" target="_blank" rel="noreferrer">GitHub Repository</a></li>
          </ul>
        </div>
        <div class="footer-section">
          <h3>Notes</h3>
          <p>Downloads are served directly from GitHub. For macOS, a signed build is recommended for the best experience.</p>
        </div>
      </footer>
    </main>
      <script>
        function copyCommand(btn) {
          const code = btn.previousElementSibling.textContent;
          navigator.clipboard.writeText(code).then(() => {
            const originalText = btn.textContent;
            btn.textContent = "Copied!";
            btn.classList.add("copied");
            setTimeout(() => {
              btn.textContent = originalText;
              btn.classList.remove("copied");
            }, 2000);
          });
        }

        const versionEl = document.getElementById("release-version");
        const releasePageLink = document.getElementById("release-page-link");
        const cards = Array.from(document.querySelectorAll("[data-platform]"));

        fetch("latest.json", { cache: "no-store" })
          .then((res) => (res.ok ? res.json() : null))
          .then((data) => {
            if (!data) return;
            if (versionEl) {
              versionEl.textContent = `Latest release: v${data.version}`;
            }
            if (releasePageLink && data.version) {
              releasePageLink.href = `https://github.com/bkeetman/folio/releases/tag/v${data.version}`;
            }
            const downloads = data.downloads || {};
            const platformLinks = {
              "darwin-aarch64": {
                primary: downloads.macos?.arm64 || downloads.macos?.x64 || downloads.macos?.dmg,
                files: [
                  { label: "DMG (Apple Silicon)", url: downloads.macos?.arm64 || downloads.macos?.dmg },
                  { label: "DMG (Intel)", url: downloads.macos?.x64 },
                ],
              },
              "windows-x86_64": {
                primary: downloads.windows?.msi || downloads.windows?.exe,
                files: [
                  { label: "MSI", url: downloads.windows?.msi },
                  { label: "EXE", url: downloads.windows?.exe },
                ],
              },
              "linux-x86_64": {
                primary: downloads.linux?.appimage || downloads.linux?.deb || downloads.linux?.rpm,
                files: [
                  { label: "AppImage", url: downloads.linux?.appimage },
                  { label: "DEB", url: downloads.linux?.deb },
                  { label: "RPM", url: downloads.linux?.rpm },
                ],
              },
            };
            cards.forEach((card) => {
              const platform = card.getAttribute("data-platform");
              const platformInfo = data.platforms?.[platform];
              const download = platformLinks[platform];
              const primaryUrl = download?.primary || platformInfo?.url;
              const primaryLink = card.querySelector("[data-primary-link]");
              if (primaryUrl && primaryLink) {
                primaryLink.setAttribute("href", primaryUrl);
              }
              const versionLabel = card.querySelector("[data-version]");
              if (versionLabel) {
                versionLabel.textContent = `v${data.version}`;
              }
              const fileLabel = card.querySelector("[data-file]");
              if (fileLabel && download?.primary) {
                const fileType = download.files.find((file) => file.url === download.primary)?.label;
                if (fileType) {
                  fileLabel.textContent = fileType.split(" ")[0]; // Just the type (DMG, MSI etc)
                }
              }
              const linksEl = card.querySelector("[data-links]");
              if (linksEl && download?.files) {
                linksEl.innerHTML = "";
                download.files
                  .filter((file) => file.url)
                  .forEach((file) => {
                    const link = document.createElement("a");
                    link.className = "card-link";
                    link.href = file.url;
                    link.target = "_blank";
                    link.rel = "noreferrer";
                    link.textContent = file.label;
                    linksEl.appendChild(link);
                  });
              }
            });
          })
          .catch(() => {});
      </script>
  </body>
</html>
